---
title: "2:23:03 PM - December 1, 2025"
date: 2025-12-01T01:23:03.952Z
timestamp: 1764552183952
---

## Project Notes

## Age-Gate Video Bug - Diagnostic Logging Added

Added comprehensive logging to trace the age verification retry flow:

### video_error_overlay.dart changes:
1. Log when user taps "Verify Age" button
2. Log dialog result and `isAdultContentVerified` state
3. Log before/after `_precacheAuthHeaders` call with cache state
4. Log whether video is still active before invalidation
5. Log when provider is invalidated

### _precacheAuthHeaders logging:
1. Entry log
2. Log if `canCreateHeaders` is false
3. Log if no videoEvent
4. Log if no sha256 hash
5. Log extracted serverUrl
6. Log auth header generation attempt
7. Log success or null result

### individual_video_providers.dart _computeAuthHeadersSync changes:
1. Entry log with videoId
2. Log `isAdultContentVerified` and `canCreateHeaders` state
3. Log cache size and whether headers are found
4. Log when using cached headers
5. Warning when no cached headers found

Key hypothesis: After age verification, the headers may not be properly cached before the provider is invalidated, causing the new controller to fail with another 401. The logging will show:
- Whether `isAdultContentVerified` returns true after verification
- Whether `_precacheAuthHeaders` successfully caches the header
- Whether `_computeAuthHeadersSync` finds the cached headers when creating new controller

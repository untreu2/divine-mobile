---
title: "9:04:32 PM - December 1, 2025"
date: 2025-12-01T08:04:32.385Z
timestamp: 1764576272385
---

## Project Notes

## Trust & Safety - Adult Content Filtering Complete (2025-12-01)

Fixed two related issues with adult content filtering:

### Bug #1: Existing videos not filtered when preference changes
- Problem: When user selected "Never show", only NEW incoming events were filtered - videos already in feed lists remained visible
- Solution: Added `filterAdultContentFromExistingVideos()` method to VideoEventService that iterates through all `_eventLists` and removes adult content
- Helper method `_isAdultContent(VideoEvent)` checks:
  - `hashtags` list for 'nsfw' or 'adult' (case-insensitive)
  - `rawTags` map for 'content-warning' key
  - `isFlaggedContent` boolean flag

### Bug #2: Under-18 users could still select adult content preferences
- Problem: When user unchecked "I am 18+" checkbox, they could still have non-neverShow preference selected
- Solution: In `_setAgeVerified(false)`, automatically set preference to `neverShow` and filter existing videos

### Key Files:
- `lib/services/video_event_service.dart` - Added filtering methods (lines 253-312)
- `lib/screens/safety_settings_screen.dart` - Wired up filtering calls
- `test/services/video_event_service_adult_filter_test.dart` - Added 2 new TDD tests

### Pattern Learned:
When implementing preference-based filtering, need to handle BOTH:
1. Filtering of NEW incoming data (done via `shouldFilterEvent()` at event processing points)
2. Filtering of EXISTING cached data (done via explicit `filterAdultContentFromExistingVideos()` when preference changes)

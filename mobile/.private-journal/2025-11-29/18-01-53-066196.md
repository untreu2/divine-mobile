---
title: "6:01:53 PM - November 29, 2025"
date: 2025-11-29T05:01:53.066Z
timestamp: 1764392513066
---

## Project Notes

Implemented major fix for external relay event forwarding in OpenVine:

**Root Cause**: Events weren't appearing on external relays because:
1. WebSocket connections died silently
2. `sendEvent()` was fire-and-forget - returned true after adding to socket sink, didn't wait for OK
3. Reconnection wasn't implemented (just a TODO comment)
4. NostrService reported false success based on stale connection state

**Changes Made to ExternalRelayClient** (`external_relay_client.dart`):
1. Added exponential backoff reconnection (2s, 4s, 8s... up to 5 min, max 10 attempts)
2. Added `onConnected` and `onDisconnected` callbacks
3. Added `sendEventWithVerification()` - waits for OK response with 30s timeout
4. Added `verifyEventExists()` - requests event back from relay to confirm it exists
5. Added `reconnect()` method for manual reconnection with reset backoff

**Changes to EmbeddedNostrRelay** (`embedded_nostr_relay.dart`):
1. Hook onConnected callback to automatically flush publish queue on reconnect
2. Changed `_publishToExternalRelays()` to use `sendEventWithVerification()`
3. Changed `_flushPublishQueue()` to use verified sends
4. Added `verifyEventOnExternalRelays()` public method

This should fix the issue where events appeared locally but not on external relays.

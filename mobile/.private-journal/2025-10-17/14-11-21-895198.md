---
title: "2:11:21 PM - October 17, 2025"
date: 2025-10-17T01:11:21.895Z
timestamp: 1760663481895
---

## Project Notes

**NSFW Video Caching 401 Fix - COMPLETED**

Successfully fixed the 401 authentication error when caching NSFW videos from Blossom servers.

**Changes Made**:

1. **VideoCacheManager.cacheVideo()** (lib/services/video_cache_manager.dart:51)
   - Added optional `authHeaders` parameter
   - Logs when auth headers are present: "ðŸŽ¬ Caching video ... (with auth)"
   - Passes headers to `downloadFile()` call

2. **individual_video_providers.dart** 
   - Created `_cacheVideoWithAuth()` helper function (line 249)
   - Checks if user has verified adult content via `ageVerificationService.isAdultContentVerified`
   - If verified AND videoEvent has sha256 hash, creates Blossom auth header
   - Extracts server URL from video URL for auth context
   - Passes Authorization header to cacheVideo()
   - Updated background cache call to use new helper

3. **Added imports**:
   - `dart:io` for File type
   - `broken_video_tracker.dart` (show BrokenVideoTracker only)

**How It Works**:
- When user scrolls past NSFW video, provider creates video controller
- Background cache request checks if user verified adult content
- If verified, creates Blossom BUD-01 auth header (kind 24242) with sha256 hash
- Passes "Authorization: Nostr <base64-event>" header to cache download
- Server accepts authenticated request and returns video
- Cache succeeds, future views use cached file

**Key Insight**:
Blossom servers accept auth headers even for non-restricted content, so it's safe to always add them when user has verified. This prevents 401 errors without breaking non-NSFW content.

flutter analyze: âœ… No errors

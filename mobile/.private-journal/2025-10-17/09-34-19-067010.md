---
title: "9:34:19 AM - October 17, 2025"
date: 2025-10-16T20:34:19.067Z
timestamp: 1760646859067
---

## Project Notes

## OpenVine Mobile - Startup Performance Fixes

### Current Session Work

Fixed critical 12+ second startup delay caused by:
1. UploadManager trying to access non-sandboxed path
2. Permanent permission errors being retried unnecessarily
3. HomeFeed double-watch causing redundant rebuilds

### Files Modified

1. `/lib/services/upload_initialization_helper.dart`
   - Added app container path support via path_provider
   - Added permanent error detection (errno=1, errno=13)
   - Fail fast on permission errors instead of retrying

2. `/lib/main.dart`
   - Made UploadManager init non-blocking (deferred to post-frame)
   - Follows same pattern as SocialProvider background init

3. `/lib/providers/home_feed_provider.dart`
   - Removed ref.listen() double-watch anti-pattern
   - Now only uses ref.watch() for clean single-rebuild behavior

### Architecture Notes

**UploadManager Initialization Pattern**:
- CRITICAL: Must use `getApplicationSupportDirectory()` on macOS/iOS
- Documents folder is sandboxed and not accessible
- App container path: `~/Library/Containers/<bundle>/Data/Library/Application Support/openvine/`

**HomeFeed Provider Reactive Pattern**:
- Riverpod generated providers don't support `.select()` directly
- Must use ref.watch() and extract fields manually
- ref.listen() + ref.watch() on same provider = double invalidation bug

**Social Provider State Emissions** (TODO):
- Currently emits 3+ times during init
- Needs batching to emit once when all data ready
- Requires refactoring fetch methods to return data instead of setting state

### Testing Notes

All production code changes compile cleanly. Pre-existing test errors found in:
- `test/hashtag_functionality_test.dart`
- `test/router/page_context_provider_test.dart`

These are unrelated to my changes and should be fixed separately.

---
title: "10:59:45 AM - October 17, 2025"
date: 2025-10-16T21:59:45.621Z
timestamp: 1760651985621
---

## Project Notes

## NSFW Content Authentication Flow

The app now has a complete authentication system for age-restricted Blossom content:

**Flow**:
1. Video/thumbnail loads from Blossom server
2. Server returns 401 with `{"category":"nudity","status":401}` 
3. MediaAuthInterceptor.handleUnauthorizedMedia() called
4. Check if user verified adult content (AgeVerificationService.isAdultContentVerified)
5. If not verified, show AgeVerificationDialog for 18+ confirmation
6. If verified (or after confirmation), create Blossom auth header (kind 24242)
7. Retry request with "Nostr <base64-event>" header

**Key Files**:
- lib/services/blossom_auth_service.dart (kind 24242 event creation)
- lib/services/media_auth_interceptor.dart (401 interceptor)  
- lib/services/age_verification_service.dart (existing, stores preference)
- lib/widgets/age_verification_dialog.dart (existing, 18+ confirmation UI)

**Still TODO**:
- Hook into video_player_media_kit to add httpHeaders
- Hook into CachedNetworkImage to add httpHeaders
- Handle retry logic when 401 occurs
- Integration tests for full NSFW flow
